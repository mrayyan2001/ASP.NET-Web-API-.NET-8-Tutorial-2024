okay guys No More Mr Nice Guy we've been letting these users use our app this whole entire time and we need that email right now how are we going to get it we're going to get it with identity via JWT now you may be asking yourself I probably probably heard of JWT but how does it actually work well first of all the user is going to log in with an email and a password we are going to issue them a JWT which is basically a fancy little string of words that will go between them and the server each time that they utilize the server it's going to validate the JWT but we can't stop there the JWT also has a couple things that you should know about has a header it has a payload and within this JWT you can see that there are little dots and each separate Little Dot represents a different part of the the JWT and within it you have the header you have the payload you have the secret and it's all encrypted by a secret that is contained within the token that's pretty much it but we need to do a couple installs so let's go ahead let's hop inside vs code and let's install these packages okay so we are inside of Visual Studio code I am in net 8 so whichever version that you are in what you want to do is you want to go to open new get Gallery we're going to type in identity it's got a pretty good search fun it's got pretty good search functionality for Nate Gallery so I'm just going to go ahead and search for identity core and you want the one that's Microsoft extensions identity core because it's got all the nice little things that we want and it will install identity with it as well so remember ma make sure that you match it up then what we're going to do is we're going to go up here and then we're going to type in Entity framework core and make sure got the right version the next thing that you want to do is type in JWT beerer Bearer and go ahead and install that one and you want core authentication JWT beerer okay so that's looking good so the first thing that we're going to add is a model for our user if you think about it we are modeling stocks we are modeling comments but we also need to hold data for our users and thankfully for us identity provides us with this identity user class that's going to go ahead and set up things like password email but also give us the ability to extend it later on so you all you get access to password you get access to email but if you want to extend it and maybe add like a bio or maybe you have some type of stock specific property that's specific to users I don't know maybe you want to add their user risk to the user you can also also extend it as well so you get the best of both worlds and first thing we're going to do is we're going to create it so we're going to go into here we're going to add a new C file and we're going to call this app user this is going to be our version this is going to be the extension of the identity user which we are going to actually inherit from and when you inherit it you're going to get like I said you're going to get access to all the defaults but you're also going to be able to add things like your own like int risk some type of specific thing that's specific only to your users but I'm going to go ahead and get rid of this I'm just going to go ahead make everything default and silently behind the scenes identity user is going to be adding things like the password and the password confirmation and you won't see it but it's actually tucked away within the actual identity user so now that we've actually created our app user and we've actually got a model for our user the next thing that we need need to do is we need to let the application DB context know that we we are now using identity and when we do this we're not going to actually add the app user to the DB context because we're going to let this thing called identity DB context take care of that for us and when we do that all we need to do is go inside of our application DB context and instead of having just the DB context right here what we are going to have is we're going to have you guess it identity DB context and we're also going to pass in our app user to let identity DB know that this is the user object that we are going to have and to plug this into our identity so now that we have our user set up and now that we have our application DB set up we need to hook them up to the program.cs file and the way that we're going to do that is we're going to add the identity then we're going to add an Entity framework store which is going to hook up our application DB context and it's going to be pretty easy but we also have some settings that we want to add as well to and the way that we're going to do that we're going inside of our program.cs just like I said and we're going to add to our Builder doservices so let's go under our used SQL and this is where I'm going to add it and first one I'm going to do is Builder doservices and I'm going to add the identity and this is where we get all of our nice extensions so first thing going to do add app user then I'm going to add the identity roll and the reason that we're going to use identity roll is that there's really no reason in our app to extend the roles you could easily extend the roles that you that you uh you can easily extend the roles but you don't have to as well too and you don't even have to extend the app user but I think in our case we definitely want to extend the app user because we're going to have some more advanced functionality so I'm going to go options go down here go ahead add add the semicolon I'm going to go options. password. require digit so we're going to have we're going to required numbers within our password and feel free to make these as uh strict or as lacks if you want to if you want to add more if you want to add more restrictions so that they have to set up a very secure password feel free to do so but going to just go through here and add all The Usual Suspects so require lowercase we're going to set that to true then same exact thing so let me go down here I'm going to go options password and I am also going to require an uppercase so require uppercase is equal to true I'm going go down here and I'm going to go password and require non-alpha numeric so we'll set that to true and let's see one more uh we're going to have a required link so password do required length and we're going to set this to 12 okay so that is looking good next thing that we want to do is just like I said next thing that we want to do is we want to go down and we want to add the Entity framework stor so Entity framework stores and we're going to go ahead toss in our application DB context go to here application DB context and go ahead add a Col into that so now we need to make our schemes and schemes is kind of a fun sending word but it basically means are you going to add JWT are you going to add cookies or are you going to add a mixture of both and because we're not using cookies we are just using Straight JWT we are going to set our scheme up in order to have JWT so let's go ahead inside of our app here and I'm going to go ahead go below the ad Entity framework stores and then here is where I'm going to add the scheme and the way that you add the scheme is pretty simple you go Builder doservices so we'll say Builder services. add authentication and we're going to go options Arrow go down I'm going to go ahead and add the colon and also I am going to add the a add JWT beer so we go add JWT beer and we'll leave this alone for now and I'm going to fill out the add authentication so the way that you felt the ad add authentication is um there's many ways that that you could do it but I'm going to show you the most explicit you could just make everything default and a lot of people do do that but I think it is good to to go into here and have a lot of these settings filled out in case you want to change them because you probably a pretty good chance that you will so what I'm going to do and if this doesn't make sense right now just kind of follow along and I'll show you what I'm going to be doing at the end so we'll go de default 4 bit scheme I'm want to go options. default scheme I like this scheme we're saying the word schemes a lot uh default signin so we're going to go default signin scheme so default signin scheme just like this and then at the very end we're going to do our default sign out scheme so options. default sign out scheme and then here is where we're going to add the default so just say j WT be defaults and we're going to say authentication scheme and this is going to set all of our defaults for us now what we're going to do is we're going to add our JWT and the way that you add JWT so first thing I'm just going to go up here kind of make everything look nice I'm going to go options go ahead and here's where we're going to add the token validation parameters so we'll say options token token validation parameters and token validation parameters comes with the JWT bear uh package so you got to make sure that you have that installed so here we're going to say validate issuer so validate issuer we're going to say true of course then we're going to say valid issuer then we're going to say builder. configuration and we're going to have to set our app settings so configuration and we will have an array here and this is going to be JWT issuer but we haven't made this yet so we need to go actually make this within our app settings and what you want to do is go beneath the allowed host just like this and we're going to say JWT so JWT and we're going to have an object and within this object we're going to have an issuer we're going to have a a audience and we're going to have a signing key and the issuer and the audience just to be real with you aren't really that important right now this will be important when you actually deploy it and the issuer and the the issuer is basically the server and the audience is whoever the users whoever is using the app it's kind of strange funky language but it is kind of what it is so we're going to go into Here Local Host and we're going to go 52 4 6 again and the this is when things going to get important so the signing key is kind of important I would pay attention here the signing key is important because it's the secret and if people actually found out your signing key you're going to be in a lot of trouble because then people can start issuing their own tokens so swordfish and I'm just going to name it swordfish I would name it if you're going to deploy this I would name it something way more secure than swordfish swordfish is just kind of a demo or a dummy word for right now so we've got now we've got our issuer now what we want to do is we want to fill out a couple more things so say validate audience and say true true then go down here and this is where we're going to add the values from our app settings so builder. configure ation is equal to JWT JWT audience okay then we're going to go down now we're going to do our signing key so validate issue our signing key true and this is where we're going to actually place our signing key so here and you need to use a form of encryption so symmetric uh security key and we're going to go down we need to convert it from bytes so system text. encoding do utf8 and say get bites so it's going to convert it from the I get what I'm guessing is a string inside of our Builder configuration to byes so configuration and JWT we're going to reach inside of our app settings and we are going to assign it the signing key so signing key okay and I'm going to go ahead and make sure look at everything one last time make sure that I have the app settings correct and it's a signing key yeah so signing key and I'm going to make sure it's spell spell everything correctly okay and then the very last thing that we want to do is we want to go under https Direction and we're going to say use authentication so we'll say use authentication and then we're going to say app.use authorization so app.use authorization okay and I think that's pretty much it so let's go ahead here what we want to do now is we want to use our EF migrations and we want to add it uh to our migrations and we also want to do the database update and this is what you want to have you want to use net EF migrations at identity and then you want to do the database update and we will know the moment of truth so we're going to go into here fingers crossed that this works holding my breath so net EF migrations at identity please work please work and looks like it works so let's go ahead do this netf database update please work please work thank you God okay let's see so go ahead I'm inside of SQL Server management Studio we go to tables would you look at that got we've got our users we've got our roles we've got our logins we got our claims and we've got our tokens everything is looking good to go we can finally do our login we can finally do our register hope that you guys enjoyed this if you did make sure to smash that like button smash that subscribe button and it's always thank you for watching