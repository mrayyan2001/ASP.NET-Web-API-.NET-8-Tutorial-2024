okay guys I'm just going to be honest we have a lot of problems and our controllers are getting way too big not only that but we have database calls inside of our controller controllers are for controlling databases are for database calling we don't want to be mixing them but how do we actually fix this well ancient code wisdom would tell us to code to an interface and truth be told nobody really knows what this term means until now you see code to an interface is actually slang for code to an abstraction and when we code to an abstraction all we are taking is very repetitive code I.E the first or default and we are going to turn it into an abstraction how do we do that Q repository pattern repository pattern comes in and what's going to happen is that we are going to change all of these first or defaults and we are going to turn them into find stock just like this as you can see I've replaced all of these individual firster defaults with fine stock and this is what dependency injection and repository patterns do they help us code to an abstraction this fine stock is an abstraction we are hiding all of this code within another method and it also provides the benefit that we can change this at any time so let's say maybe we want an as innumerable or maybe we want some other filter or maybe we want the ability to add ascending or descending when we abstract away code we can make changes that affect all of these other pieces of code right here and that is the whole entire idea behind abstractions that is the whole entire idea behind dependency injection but before we go let's talk about dependency injection because this is really important 99% of dependency injection that you see is going to be Constructor based and the reason that we need dependency injection is because we need to preheat the metaphorical code oven we need to have objects we need to have certain things lined up so that when we actually use these new methods these new abstractions that we are going to create we have objects on hand and what is that object going to be it is going to be the application DB context that we made we need the database before we do anything else so within that Constructor we are going to pass the DB context just like we did in our controllers but just in a different class and that is the whole entire idea behind repository pattern and dependency injection let's hop inside vs code and let's actually hook one up okay so the first thing that we need to do is we need to create a folder for our interfaces and I'm just going to go into here create a folder called interface faces I'm going to right click go instead of class I'm going to go to interface and I'm going to create an ey stock repository yes almost like iPod I'm going to add an i in front of that and that's convention because it's good to be able to identify them with that little ey in the front the next thing that I'm going to do is I'm going to add a task and I'm going to add a list in this list is going to be a list of stocks and I'm going to have a get all or I'm going to gets all async now interfaces are something that you could spend the rest of your life reading about but what interfaces really do is just allow us to plug in this code to other places and allow us to abstract our code away and that may be confusing but let's go back to our controller really quick as I mentioned in the Whiteboard we want to get rid of all of these database calls we want these database calls out of our controller because a controller is for manip manipulating the URLs and controlling that but they're not really here for databases so what are we going to do we are going to create an actual repository now I going to create a repository folder and you may be asking yourself well what about the interfaces here's the key thing interfaces don't really even exist interfaces are just here to do this I'm going to go into here I'm going to create a class not an interface I'm going to call this create stock repository so I go into here I create stock repository and the whole point of an interface is so that we can plug in our iock repository just like this and we can quickly go in and implement the interface if you didn't see what I did there I press control Dot and it gives me the ability to implement the interface and we do this because our codebase is really small right now but you could imagine if you were working on an app for some employer and you had a you had an interface with thousands upon thousands of methods and it was some type of let's say super important data access and you implemented all of those methods it would make more sense because you are implementing very important actions and many times people describe interfaces as contracts for this very reason they're contracts because if you're going to use this super important repository you're going to use a super important code you need to implement the interface you need to implement the contract the interface as it is set up but we're just going to go back here and we're going to turn it into the get all async because that's what we really want to do then what we're going to do is we're going to take our stock controller and we're going to go up to all of these database calls and just kind of one by one we're going to start getting rid of a lot of this boiler plate code so here I can go ahead get this out and I can go into my stock repository and I can just say return await to list async but remember that we need to actually bring in our DB context and this is where dependency injection really comes to play right now we just implemented the repository pattern but now we're going to implement dependency injection and this is all dependency injection is and you actually did it before you were using dependency injection before we even talked about it so when you bring in your DB context so we're going to go into here we're going to say DB context actually I think I'm just going to short that context I think it looks better just as context go context just like this so uh context inherent from this and what's happening is that this application DB context this Constructor is going to execute and this context is going to be brought in before any of this is brought in and this is what's going to quote unquote preheat the oven this is what's going to bring in the database before we actually use any of it and we're also going to go up here we're going to go private read only also bring in our application DB context let go into here underly context just like this and we have our two list async we probably need to uh bring that in with ND framework core that looks good so let's go over to here and now we're going to go ahead and get everything out of the controller so now that we're inside the controller what we're going to do is we're going to leave the application DB context in here for now but we are going to leave our application DB context in here for now but what we're going to do is eventually we're going to remove this get this out of here because we don't want the d we don't want the database in here in the future we still need it for now because we need these methods to work but what we're going to do is we're going to bring in our actual repository so we go iock repository then I'm going to call this the see here stock repo so so I'm going to call it stock repo then down here I'm going to go stock repo it's going to get this from The Constructor so we're going to go stock repo right here then I'm going to go up to here and I'm also going to add the ey stock repo at the top so I'm going to go I stock repo uh stock repository going to go stock repo and we'll go ahead bring that in so stock repo and that's going to inherit from here now everything's pretty much good to go we've got all of our groundwork laid now what we can do is we can actually go into here and we can put our get all async instead of having this context instead of have bringing in all of this from the database we can now go into here we can go stock repo and we can say get all a sync and everything should work the last thing that we need to do is we also need to go into our program.cs and before we do anything else we need to wire this up now in the very beginning of the series I said something about this is where services are held we need to wire up our services and the way that we wire up our services is right before the app what we are going to do is we're going to go into here we're going to say Services we're going to say add scoped and then we are going to go ahead we are going to add our I stock repository stock repository go ahead go do that and we should be good to go also you're going to need to make sure that you restart this otherwise it is not going to work so go into here go ahead start it up hopefully it'll run and let's go in and check our get all make sure our get all is working and if you look at that our G all is working and not only that but our stock controller is looking a little bit better plus we have everything laid out we can really go through and start abstracting stuff and getting stuff out of the controllers after this anyways hope that you guys enjoyed this if you did make sure to smash that like button smash that subscribe button and as always thank you for watching