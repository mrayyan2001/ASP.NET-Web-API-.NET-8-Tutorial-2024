so the process of creating a Mino mini relationship can seem very confusing on the surface but once you break it down into its smaller parts it's actually pretty intuitive and let's go back to the diagram that we had before when we create a many to many relationship basically we're trying to create this join table we are trying to sandwitch our user and our stock ID into one table by itself so that like I said we can have infinite relationship but let's just talk about it in terms of pseudo code if you're going to get the user ID and the stock ID put them into a table how' you go about it well first thing you probably already knew you just get the user so you get the user first and once you get the user you can then populate it with the ID then you probably know where I'm going with this you get the stock so you have the symbol you can get the stock and once you get the stock then you have the stock ID so we have the user ID and the stock ID but what about the third part this is where it gets kind of crazy you create an object and the object that you create is going to be your portfolio and essentially all that you're going to do is just new up a portfolio and then you put your user ID and then you put your stock ID into the where the stock ID part is and then you save it to the database and that is how we create a many to many relationship so let's go ahead let's hop inside vs code and let's do some coding okay so we are inside of Visual Studio code right now and we want to start creating our endpoint and we're going to first thing is we're going to post and then of course we are going to authorize because we need the claims from the token so public async task I action result and we are going to call this add portfolio just a simple add so add portfolio and we're going to need the stock symbol so the way that we are going to identify the stock is through the symbol so first thing we got to grab the user and we're going to go back into our claims extension and we are going to get the username once we have the username we can now now go ahead and grab our user just like we did before and we're going to await and this is going to be the user manager and we're going to find by name async and just go ahead pass in our username next thing that we're going to do is we're going to grab the stock and we are going to get the stock by the symbol and we're going to be getting the stock by the symbol a lot so let's just go ahead and create an interface or create a uh reposit itory method for it so I'm going to go within the stock repository and right under gby ID async I'm going to create a get by symbol stock method and go into here this is going to be optional and we're going to say get by symbol a sync and of course we're going to pass in the symbol so then our stock repository is going to light up and we'll go into our iock repository we're going to implement this interface scroll down going to find it and this one's going to be easy because we're just going to return a method that is going to filter all of these stocks and search by the symbol pretty simple so go into here we going to go stocks use good old first or default async and say s do symbol is equal to the symbol pretty simple so we've got our repository we've got our get by symbol so now we can go back in and we're going to utilize it so get by symbol and then go ahead pass in the symbol so now that we've got all of our data we're going to do a couple validation checks and the first thing that we need to check for is if the stock is actually there we could also check if the user is in here or if the user is actually populated but authorized is going to do that for us so I don't think we really need to do that that'd be kind of repetitive but you could if you wanted to and we'll say stock not found so if there is no stock we're going to say stock not found we don't have a lot of stock market data right now we're going to add stock market data uh here in a couple of videos but for right now we're just going to check to see if this if the stock is there uh next thing we're going to do we're going to get the user portfolio and we need to make sure that we're not adding duplicates because you don't want the user to be able to add the same exact stock over and over that really wouldn't make sense and kind of be um not a good user experience so we'll go ahead we're going to get the user portfolio and we're going to run another validation check to see if anything that exists within the user portfolio is equal to the symbol that we are trying to get so we're going to go into here we're going to say symbol and we're going to to lower it just to be sure and we're going to check by the symbol that we passed through the API so say symbol and also make sure to lower just to be on the safe side I think it still would check it but uh make sure probably be good just to lower it just in case so say bad request and if uh the stock does exist in there can I add same stock to portfolio Okay so that looks good go ahead add a semicolon here we're good to go and here's where we're going to actually create the object so if we're good to go we're clear for takeoff we're going to say the portfolio model we're going to new up a brand new portfolio and this is what I was talking about the third and final step or the fourth and final step or this is actually the third but the third step is to create the uh portfolio object then we add the portfol portfolio object to the database so we'll say stock. ID we say app user uh ID is equal to app user. we're looking good got to add semicon here um now what we have to do is we could put the create directly into the controller but that's bad that's uh bad that's a pretty much a code smell so we're going to go ahead into our portfolio repository and we're going to make a create async so we're going to go into here we're going to say task we're going to return a portfolio and we're going to call this create a sync and we're going to pass in the portfolio so say portfolio we're going to pass in portfolio looking good uh now we need to go into the actual portfolio repository we need to implement it and this is actually not going to be much different from any of the other creates that we made so I'm going to go into here of course going to uh async this make sure we got async and we're going to await going to say context portfolios. add async we're going to go ahead toss in that Port toss in the portfolio uh next thing that we're going to do is we're going to save changes of course can't forget that and then we're going to return the portfolio so say return portfolio looking good so we can quickly just go back now that we've got all of our infastructure setup this is going to be really easy and we'll just say await I'm going to say a portfolio repo create async and toss in the portfolio model let's see and if portfolio model is equal to null uh we'll give some type of error we'll say return status code 500 could not create so return status code and this is very likely to be uh executed but just in case we'll we'll go ahead do a quick little null check could not create and if it is created we'll go down here and this is where we'll return created so let's see return created looking good so that's pretty much it let's go ahead and let's test it so I'm going to go ahead fire up the server.net watch run okay so I'm inside of swagger right now make sure that you are logged in make sure that your beer token is uh within the authorized right here and that the little green lock is um locked then we're going to find a stock so I'm going to go ahead we have Tesla we have palente here I think Tesla is already in my portfolio so let's go ahead let's add paler so I'm going to go into here I'm going to type in pltr and we have a success Also let's go ahead check to make sure that is within our portfolio and if you look inside the portfolio we have paler in our portfolio we've created the man to Mania relationship anyways hope that you guys enjoyed this if you did Smash that like button smash that subscribe Button as always thank you for watching